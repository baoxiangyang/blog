<h2>MongoDB</h2>
<blockquote><p>MongoDB<br>是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的，语法有点类似javascript面向对象的查询语言，它是一个面向集合的，模式自由的文档型数据库。</p></blockquote>
<h2>mongodb与 mysql性能比较</h2>
<p><img data-src="/img/bVKmo1?w=837&amp;h=349" src="/img/bVKmo1?w=837&amp;h=349.png"></p>
<h2>应用范围和限制</h2>
<blockquote><p>缺点:不支持连表查询，不支持sql语句，不支持事务存储过程等，所以不适合存储数据间关系比较复杂的数据，一般主要是当做一个数据仓库来使用。<br>适用于：日志系统，股票数据等。 不使用于：电子商务系统等需要连多表查询的功能。</p></blockquote>
<h2>mongoDB的基本概念</h2>
<p><strong>文档</strong></p>
<blockquote><p>文档是mongoDB中数据的基本单元，类似关系数据库的行， 多个键值对有序地放置在一起便是文档。  MongoDB&gt; 中以文档的方式存取记录，如一条记录格式如下： <br> { “username”:”Tom”, “age”:10,email:’xiaobai@sohu.com’,’sex’:男} { "username":"Tom" , "age" : "10" }<br>{“Username”:”Tom”,”age”:10}  {“Username”:”Tom” }</p></blockquote>
<p><strong>注意：</strong></p>
<blockquote><p>（1）以上是几个不同的文档，MongoDB区分大小写的数据类型，第一个age字段是数字类型，第二个age是字符串类型。<br>（2）每一个文档尺寸不能超过16M</p></blockquote>
<p><strong>集合</strong></p>
<blockquote><p>集合就是一组文档，多个文档组成一个集合，集合类似于 mysql里面的表 。 无模式是指，在同一个集合中可以包含不同格式的文档，如： {  <br>"Name" : "Mongodb" ,  "Type" : "Nosql"  } {   "UserName" : "Tom"  , <br>"age"  :  20  ,  "Gender"  :  "male"  } 以上两个文档可以放在同一个集合中。<br>在Mysql需要先建表再插入数据，  模式自由（schema-free）：意思是集合里面没有行和列的概念， <br>注意：MongoDB中的集合不用创建、没有结构，所以可以放不同格式的文档。</p></blockquote>
<h2>数据结构体系</h2>
<p><img data-src="/img/bVKmp5?w=517&amp;h=614" src="/img/bVKmp5?w=517&amp;h=614.png"></p>
<h2>windows怎么安装mongodb呢?</h2>
<p>使用管理员命令运行</p>
<pre><code>//安装服务 配置dbpath,logpath
cd d:\wamp64\bin\mongodb-win32-i386-2.0.3\mongodb-win32-i386-2.0.3\bin
mongod –install –logpath d:/mongo/log.txt  --dbpath d:/mongo/data

//启动服务

net start mongodb

//如果服务异常尝试卸载重装   可以查看服务所在路径是否是指定的路径

mongod.exe --remove --servicename mongodb
</code></pre>
<h2>数据库的操作：</h2>
<p>//显示所以的数据库</p>
<pre><code>show dbs;
</code></pre>
<p>//指向db库</p>
<pre><code>use db;
</code></pre>
<p><strong>查看集合</strong></p>
<blockquote><p>语法：show tables5、查询集合里面的文档 <br>语法： db.集合名.find()  查询所有 db.集合名.findone()<br>查询第一个文档 删除集合 语法：db.集合名.drop();<br>删除数据库语法：db.dropdatabase()</p></blockquote>
<pre><code>//删除php集合
db.php.drop;
</code></pre>
<h2>文档的操作:</h2>
<p>以下操作集合以php(集合)为例：</p>
<pre><code>//插入文档到php集合中 
db.php.insert({name:’xiaoyi’});
//查看php集合的数据
db.php.find();
//根据条件进行查询
db.php.find(),{age:18};
//取出单条数据

db.php.findone();

//查询集合的前8条数据
db.php.limit(8);
//偏移量的使用  skip  
db.php.find().skip(2).limit(1);
//显示文档的个数  
db.php.count();
//删除文档
db.php.remove({});
//删除指定条件的数据  $lt(&lt;),$gt(&gt;)
db.php.remove({age:{'$gt':25}});
//修改指定的文档
db.php.update({'name':'xiaobao'},{'age':58});
</code></pre>
<h2>用户管理</h2>
<pre><code>//用户添加
//切换到指定的数据库
use stu;
//为其增加用户
db.adduser(’xiaoyi’,’admin’);
如何通过权限验证
（1）选择数据库
    Use stu;
（2）执行db.auth(用户名，密码)
    Db.auth(‘xiaoyi’,’admin’); 
//删除用户和修改密码注意：创建的用户名和密码是存储在各自数据库里面的system.users集合里面的。
//获取到用户信息
Db.system.users.find();
//想要删除用户，则直接删除system.users集合里面文档即可。
Db.system.users.remove({name:’xiaoyi’});

</code></pre>
<h2>总结说明：</h2>
<blockquote><p>（1）非admin数据库的用户不能使用数据库命令，比如show dbs等。 <br>（2）admin数据库中的用户被视为超级用户（即管理员）。在认证之后，管理员可以读写所有数据库，执行特定的管理命令， <br>（3）在开启安全检查之前，一定要至少有个管理员账号。 <br>（4）数据库的用户账号以文档的形式存储在system.users集合里面。可以在system.users集合中删掉用户账号文档，就可以删除用户。</p></blockquote>
<h2>MongoDB的索引：</h2>
<p><strong>普通单列索引</strong> <br>测试代码：</p>
<pre><code>&gt; for(var i=0;i&lt;200000;i++){ 
... db.java.insert({name:'xiao'+i,age:i}) 
... } 
</code></pre>
<p>第一：先检验一下查询性能</p>
<pre><code>var start = new Date()
db.java.find({name:'xiao156789'}) 
var end = new Date() 
end-start
</code></pre>
<p>第二：为name创建索引</p>
<pre><code>db.java.ensureIndex({name:1}) 
</code></pre>
<p>第三：再执行第一部分代码可以看出有数量级的性能提升 <br>没有添加索引时使用时间是；</p>
<pre><code>Var start=new date();
Db.php.find();
Var end=new Date();
End-start
</code></pre>
<p>添加索引</p>
<pre><code>Db.php.ensureIndex({name:1});
</code></pre>
<p>添加完成后，再次查询</p>
<blockquote><p>语法： db.集合名.ensureIndex({键名：1}) 1是升续 -1是降续 多列索引（复合索引）  创建多列索引 <br>db.集合名.ensureIndex({field1:1/-1, field2:1/-1});</p></blockquote>
<pre><code>db.php.ensureIndex({name:1,age:1});
</code></pre>
<p>可以使用db.集合名.getIndexes()查看创建的索引情况。</p>
<p><strong>子文档索引</strong></p>
<blockquote><p>语法： db.集合名.ensureIndex({filed.subfield:1/-1}); 如下文档可以建立子文档索引<br>{name:’诺基亚手机1’,price:12.34,spc:{weight:100,area:’纽约’}}<br>{name:’诺基亚手机2’,price:42.34,spc:{weight:200,area:’伦敦’}}<br>比如要查询weight等于100的文档。 db.goods.find({‘spc.weight’:100})  <br>根据当前案例，我们建立子文档索引</p></blockquote>
<pre><code>db.net.ensureIndex({'spc.w':1})
</code></pre>
<p><strong>唯一索引：</strong></p>
<pre><code>//保证文档数据的唯一性
Db.php.ensureIndex({name:-1},{unique:true});
</code></pre>
<p>//稀疏索引与普通索引两者的区别</p>
<p><img data-src="/img/bVKnOH?w=554&amp;h=185" src="/img/bVKnOH?w=554&amp;h=185.png"></p>
<pre><code>//稀疏索引的建立
Db.php.ensureIndex({email:1},{sparse:true});
</code></pre>
<p>查看索引<br>常用命令: <br>（1）    查看当前索引状态: db.集合名.getIndexes();</p>
<pre><code>Db.php.getIndexes(); 
</code></pre>
<p><img data-src="/img/bVKnOU?w=552&amp;h=296" src="/img/bVKnOU?w=552&amp;h=296.png"></p>
<p>（2）详情查看本次查询使用哪个索引和查询数据的状态信息。</p>
<pre><code>db.php.find({name:’xiao’}).explain() 
</code></pre>
<p><img data-src="/img/bVKnOY?w=482&amp;h=292" src="/img/bVKnOY?w=482&amp;h=292.png"></p>
<p><img data-src="/img/bVKnO6?w=552&amp;h=168" src="/img/bVKnO6?w=552&amp;h=168.png"></p>
<h2>删除索引</h2>
<p><strong>删除单个索引</strong></p>
<blockquote><p>语法：db.集合名.dropIndex({filed:1/-1});</p></blockquote>
<pre><code>db.php.dropIndex({name:1});

//删除所有的索引 
Drop.php.dropIndexes();

//获取到集合索引
db.php.getIndexes();
</code></pre>
<p><strong>重建索引</strong></p>
<blockquote><p>一个表经过很多次修改后,导致表的文件产生空洞,索引文件也如此.  可以通过索引的重建,减少索引文件碎片,并提高索引的效率. <br>类似mysql中的optimize table  mysql里面使用optimize table语法：optimize table 表名<br>db.集合名.reIndex()</p></blockquote>
<pre><code>Db.php.reIndex();
</code></pre>
<p><strong>索引使用注意事项</strong></p>
<blockquote><p>（1）创建索引的时候，注意1是正序创建索引  -1是倒叙创建索引<br>（2）索引的创建在提高查询性能的同时会影响插入性能，对于经常查询少插入的文档可以考虑用索引 <br>（3）复合索引要注意索引的先后顺序。<br>（4）每个键全建立索引不一定就能提高性能，索引不是万能的。 <br>（5）在做排序工作的时候如果是超大数据量也可以考虑加上索引用来提高排序的性能。</p></blockquote>
<p><strong>mongoDB的导入与导出</strong><br>（1）导出数据</p>
<pre><code>导入/导出可以操作的是本地的mongodb服务器，也可以是远程的，所以，都有如下通用选项。
</code></pre>
<blockquote><p>利用mongoexport <br>-h host主机<br>--port 端口<br>-d 指明使用的库<br>-c 指明要导出的集合<br>-o 指明要导出的文件名<br>--csv指定导出的csv格式<br>-q 过滤导出<br>-f field1 field2  列名<br>-u username 用户名<br>-p password 密码</p></blockquote>
<p>如下操作，</p>
<pre><code>mongoexport.exe -h localhost -d stu -c php -o f:/php.json
</code></pre>
<p><strong>导入数据</strong></p>
<blockquote>
<p>使用mongoimport命令<br>-d 待导入的数据库<br>-c 待导入的集合（不存在会自己创建）<br>--type csv/json(默认) <br>--file 备份文件路径</p>
<p>例1: 导入json  ./bin/mongoimport  -h  --port  端口号  -d test -c goods<br>--file ./goodsall.json    例2: 导入csv  ./bin/mongoimport -h  --port  端口号 -d test -c goods --type csv -f goods_id,goods_name --file ./goodsall.csv  ./bin/mongoimport -h  --port  端口号 -d test -c goods<br>--type csv --headline -f goods_id,goods_name --file ./goodsall.csv</p>
</blockquote>
<p>案例：把刚才导出的php.json文件导入到user库里面的php集合里面。</p>
<pre><code>mongoimport.exe -d stu -c java --file f:/php.json
</code></pre>
<p>导入成功，进行查看</p>
<p><img data-src="/img/bVKnMZ?w=507&amp;h=61" src="/img/bVKnMZ?w=507&amp;h=61.png"></p>
<h2>主从复制</h2>
<p>主从复制是一个简单的数据库同步备份的集群技术。主服务器负责数据的增删改，从服务器同步主服务器实现数据的同步。</p>
<p>1原理图：</p>
<p><img data-src="/img/bVKnM3?w=475&amp;h=239" src="/img/bVKnM3?w=475&amp;h=239.png"></p>
<p>2、实现的注意点；<br>（1）在数据库集群中要明确的知道谁是主服务器，主服务器只有一台。<br>（2）从服务器要知道自己的数据源也就是对于的主服务是谁。<br>（3）--master用来确定主服务器，--slave和--source来控制从服务器。<br>3、配置步骤：<br>可以通过不同端口来模拟多台mongodb服务器。</p>
<p>（1）启动主服务器</p>
<p><img data-src="/img/bVKnNm?w=553&amp;h=43" src="/img/bVKnNm?w=553&amp;h=43.png"></p>
<p>（2）启动从服务器</p>
<p><img data-src="/img/bVKnNn?w=548&amp;h=57" src="/img/bVKnNn?w=548&amp;h=57.png"></p>
<p>（3）客户端登陆到主服务器<br>添加一些数据，测试是否同步到从服务器<br>如下在主服务器里面，添加了一些文档<br>第一步：客户端登录到主服务器，添加一些文档</p>
<p><img data-src="/img/bVKnNp?w=553&amp;h=220" src="/img/bVKnNp?w=553&amp;h=220.png"></p>
<p>第二步：登陆到从服务器，查看是否有数据</p>
<p><img data-src="/img/bVKnNz?w=553&amp;h=166" src="/img/bVKnNz?w=553&amp;h=166.png"></p>
<p>如果有数据，则成功了。</p>
<h2>php操作mongodb</h2>
<p>插入文档：</p>
<pre><code>//(1)新建一个集合python，添加文档,
//注意：在php里面代码操作时，在黑窗口里面使用'.'地方就变成使用‘-&gt;’,{}就变成关联数组
//db.python.insert({name:'wawa',age:4})
$m=new Mongo("mongodb://root:root@localhost:8888/admin");
$db=$m-&gt;selectDb("stu");//选择数据库
$db-&gt;python-&gt;insert(array('name'=&gt;'wawa1','age'=&gt;12));
$db-&gt;python-&gt;insert(array('name'=&gt;'wawa2','age'=&gt;22));
$db-&gt;python-&gt;insert(array('name'=&gt;'wawa3','spc'=&gt;array(‘w’=&gt;100,’age’=&gt;20)));
$db-&gt;python-&gt;ensureIndex(array(‘name’=&gt;1,array(‘’)))
echo 'ok';
//查询文档
$data = $db-&gt;net-&gt;find();
foreach($data as $v){
    echo $v['name'].'---'.$v['age'].'----'.$v['email'].'&lt;br/&gt;';
}
//删除文档
db.net.remove({age:{'$gt':10}})
$res = $db-&gt;net-&gt;remove(array('age'=&gt;array('$gt'=&gt;10)));r435
//增删改查
//注意，在命令行里面的    .变成-&gt;      {}变成数组
//(1)添加一个文档
//$db-&gt;php-&gt;insert(['name'=&gt;'程咬金','age'=&gt;22]);
//(2)查询文档
//$data = $db-&gt;php-&gt;find();
//查询年龄等于9的文档
//$data = $db-&gt;php-&gt;find(['age'=&gt;9]);
//查询年龄大于9的文档db.php.find({age:{'$gt':9}});
//$data = $db-&gt;php-&gt;find(['age'=&gt;['$gt'=&gt;9]]);
//根据年龄降序显示
//$data = $db-&gt;php-&gt;find()-&gt;sort(['age'=&gt;-1]);
//(3)修改文档，我们直接使用修改器来完成，
//把年龄等于8的名称改名为'李白'
//db.php.update({age:8},{'$set':{'name':'李白'}})
//$db-&gt;php-&gt;update(['age'=&gt;8],['$set'=&gt;['name'=&gt;'李白']]);
//(4)删除文档
//比如删除年龄等于10的文档
//$db-&gt;php-&gt;remove(['age'=&gt;10]);
$data = $db-&gt;php-&gt;find();
foreach($data as $v){
        echo $v['name'].'----'.$v['age'].'&lt;br&gt;';
}
</code></pre>