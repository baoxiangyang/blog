<blockquote><p>屏幕适配是一个很容易被忽略的问题，但对于精益求精的产品而言，是必不可少的。对于Web开发的求职者而言，也是一个必需要理解清楚的经典问题</p></blockquote>
<p>文 | 啃先生 Mar,1st,2016</p>
<h2>壹 | Fisrt</h2>
<p><strong>移动端适配的是什么？</strong><br>我们讨论的是网页适配多种尺寸屏幕，让网页效果看起来和设计师的设计稿一样。说白了就是<strong>同一套代码在不同分辨率的手机上跑时，页面元素间的间距，留白，以及图片大小会随着变化</strong>，在比例上跟设计稿一致。</p>
<p><strong>举个例子吧</strong></p>
<p><img data-src="/img/bVs80Z" src="/img/bVs80Z.png"><br>图1.  260*400的屏幕</p>
<p><img data-src="/img/bVs802" src="/img/bVs802.png"><br>图2.  380*400的屏幕</p>
<p>上边的页面在不同大小屏幕上的展现，咋一看没什么问题，一般的工程师会认为已经OK了，所以前端工程师很容易忽略屏幕适配。但是对于一些精益求精的产品而言，这还达不到要求。例如有以下问题：</p>
<ol>
<li><p>图1的屏幕的尺寸较小，因此头像应该小些，话题左边的空白也应该小一些。</p></li>
<li><p>图片应该保持正方形，而且两张图之间的边距应该随屏幕变化而变化</p></li>
</ol>
<blockquote><p>明白了，所以padding，margin，图片等的大小基本都要做适配</p></blockquote>
<h2>貳 | Second</h2>
<p><strong>那有什么方法可以做到这种适配？</strong><br>关键要找到一种长度单位，使得一样的取值，在不同尺寸的屏幕上的大小按比例缩放。<br><strong>长度单位我只知道px 😂</strong><br>我将在下一期的文章里推有关viewport和css像素px中的细节，这篇文章只关注如何适配，所以先只谈结论：</p>
<ol>
<li><p>网页在viewport中布局，viewport被分成一个个小方块，一个CSS像素占一个方块</p></li>
<li><p>在设置了viewport宽度等于设备宽度的情况下，通过某种算法，在不同大小的屏幕上，1个CSS像素所占屏幕的物理尺寸是一样大的<br>既然1个CSS像素在不同屏幕上物理尺寸一样大，那px肯定不能做为适配的方法了</p></li>
</ol>
<blockquote><p>长度单位rem是相对于html标签的font-size来计算的。例如html标签设置font-size:36px，同时div设置width:1.2rem。那么这个div的宽度就是<strong>1.2rem=36px*1.2=43.2px</strong></p></blockquote>
<p>如上面的例子，如果加载页面的时候，使用JS根据屏幕的大小动态设置html标签的font-size，随着html标签font-size的值变化，div的1.2rem换算成px的值 也跟着变化，即实现了div随屏幕大小变化而变化，而CSS代码始终是width:1.2rem。以此类推到页面所有的元素。</p>
<blockquote><p>明白了，奥秘就在于结合px的固定尺寸和rem的相对尺寸！</p></blockquote>
<h2>叁 | Third</h2>
<blockquote><p>原理我明白了，你有没有可执行的具体方案 😳？</p></blockquote>
<p>业内比较流行的做法（参考阿里的flexible），有以下要点：</p>
<ol>
<li><p>设置viewport为设备宽度（这里不一定，但目前先这样足矣）</p></li>
<li><p>将viewport分成10rem，并计算出1rem在当前浏览器的像素值，把它赋予html标签的font-size（分成10rem只是为了方便计算而已）</p></li>
<li><p>写CSS代码时，遇到要适配的地方，比如width，margin，padding等，就不要再用px了，改成用rem</p></li>
</ol>
<p>JS和Html代码如下：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="zh-cn"&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta name="viewport" content="width=device-width, height=device-height"&gt;
    &lt;title&gt;啃先生的网&lt;/title&gt;
    
    &lt;script type="text/javascript"&gt;
        var cssEl = document.createElement('style');
        document.documentElement.firstElementChild.appendChild(cssEl);
    
        function setPxPerRem(){
            var dpr = 1;
            //把viewport分成10份的rem，html标签的font-size设置为1rem的大小;
            var pxPerRem = document.documentElement.clientWidth * dpr / 10;
            cssEl.innerHTML = 'html{font-size:' + pxPerRem + 'px!important;}';
        }
        setPxPerRem();
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>CSS代码做了类似如下的修改：</p>
<p><img data-src="/img/bVs81R" src="/img/bVs81R.png"><br>运行结果如下：边距和头像图片都随屏幕变化而变化了</p>
<p><img data-src="/img/bVs81W" src="/img/bVs81W.png"></p>
<p><img data-src="/img/bVs81X" src="/img/bVs81X.png"></p>
<h2>肆 | Fourth</h2>
<blockquote><p>代码量很少，就是要理解消化。有一个问题，设计师给的设计稿尺寸单位都是用px，但是刚刚说的第3步，写CSS的时候要用rem，这个怎么换算？会很麻烦</p></blockquote>
<p>现有设计师提供宽度为400px的设计稿，其中某个图片的宽度设计为20px，那么，CSS的写法就是img{width: 0.5rem;}，怎么得出这个结果的呢？</p>
<ol>
<li><p>设计稿的宽度视同手机宽度，即假设有一个viewport为400px的手机</p></li>
<li><p>将它分成10rem，每个rem为40px;</p></li>
<li><p>那么图片宽度20px自然就是0.5rem;</p></li>
</ol>
<p>且慢，岂不是意味着，每次写到尺寸的地方，我都要先在草稿纸上把设计师给的px换算成rem？别急，sublime text 3有一款插件可以帮助你进行这个换算，你只需要输入20px，它会自动帮你换算成 0.5rem，看以下图就秒懂了</p>
<p><img data-src="/img/bVs82g" src="/img/bVs82g.png"></p>
<h2>参考</h2>
<ol>
<li><p>使用Flexible实现手淘H5页面的终端适配（<a href="https://github.com/amfe/article/issues/17">https://github.com/amfe/article/issues/17</a>）</p></li>
<li><p>移动端高清、多屏适配方案（<a href="http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041">http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041</a>）</p></li>
<li><p>A tale of two viewports（<a href="http://www.quirksmode.org/mobile/viewports.html">http://www.quirksmode.org/mobile/viewports.html</a>）</p></li>
</ol>
<p><img data-src="/img/bVs82n" src="/img/bVs82n.png"><br>移动适配这个会作为一个小系列来写，下期写浏览器是怎么计算CSS像素的，它在不同屏幕上的差异。</p>
<p>啃先生  开始码字才知道码字不易，坚持码字更不易。转载请声明来源</p>
<p><img data-src="/img/bVs87M" src="/img/bVs87M.png"></p>