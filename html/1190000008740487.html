<h1>Nodeå‘½ä»¤è¡Œå·¥å…·å¼€å‘ã€çœ‹æ®µå­ã€‘</h1>
<blockquote><p>ä½ æœ‰æ²¡æœ‰ä¸Šç­æƒ³çœ‹ç¬‘è¯å´åˆæ€•é¢†å¯¼å‘ç°çš„ç»å†ï¼Ÿç°åœ¨æˆ‘ä»¬å°±ç”¨å‡ åè¡Œä»£ç å†™ä¸€ä¸ªå‘½ä»¤è¡Œçœ‹ç¬‘è¯æ®µå­çš„å°ç¨‹åºï¼Œä»æ­¤æ— éœ€æ‹…å¿ƒé¢†å¯¼çš„è§†å¯Ÿã€‚è¿™ç¯‡æ–‡ç« å’Œä¸Šä¸€ç¯‡å·®ä¸å¤šéƒ½æ˜¯å‘½ä»¤è¡Œå°å·¥å…·å¼€å‘ï¼Œä¸è¿‡æœ¬ç¯‡æ›´åå‘äºå°çˆ¬è™«çš„å¼€å‘</p></blockquote>
<h2>æ€»è§ˆï¼šå‘½ä»¤è¡Œçœ‹æ®µå­å°ç¨‹åº</h2>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬ä»Šå¤©çš„å°ç›®æ ‡ï¼š</p>
<ul>
<li><p>å…ˆä¸ºå®ƒèµ·ä¸ªå‘½å§ï¼š<code>joke-cli</code></p></li>
<li><p>çˆ¬å–å¹¶æå– <a href="http://www.qiushibaike.com/">ç³—äº‹ç™¾ç§‘çš„ç¬‘è¯</a></p></li>
<li><p>è¾“å‡ºåˆ°å‘½ä»¤è¡Œ<em>æŒ‰ä¸‹å›è½¦æ˜¾ç¤ºä¸€æ¡æ®µå­</em></p></li>
</ul>
<h2>åˆè¯†[æ–°æ‰‹æ‘]</h2>
<p>ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»ä»Šå¤©ç”¨åˆ°çš„ä¸»è¦æ¨¡å—</p>
<h3>cheerio</h3>
<blockquote><p><strong><code>cheerio</code></strong>å¯ç†è§£ä¸ºæœåŠ¡å™¨ç«¯çš„jQueryï¼ŒåŸºæœ¬ç”¨æ³•ä¸jQueryä¸€æ ·ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬åœ¨å†™å°çˆ¬è™«æ—¶å°±å¯æŠ›å¼€é‚£å¯çˆ±åˆå¯æ¨çš„æ­£åˆ™è¡¨è¾¾å¼äº†ã€‚ä»æ­¤æ‹¥æŠ±å¹¸ç¦ç”Ÿæ´»ã€‚</p></blockquote>
<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="javascript">let cheerio = require('cheerio')

// å°†htmlæ–‡æœ¬è½¬åŒ–æˆå¯ç”¨jQueryæ“ä½œçš„dom,,ç„¶åä½ å°±å¯ä»¥æŠŠå®ƒå½“æˆjQueryäº†
let $ = cheerio.load('&lt;h2 class="title"&gt;Hello world&lt;/h2&gt;')
 
$('h2.title').text('Hello there!')
$('h2').addClass('welcome')
 
$.html()
//=&gt; &lt;h2 class="title welcome"&gt;Hello there!&lt;/h2&gt; </code></pre>
<p><em>æ›´å¤šè¯·å‚è€ƒ<a href="https://cheerio.js.org/">cheerio</a></em></p>
<h3>superagent</h3>
<p><code>superagent</code>ä¸“æ³¨äºå¤„ç†æœåŠ¡ç«¯/å®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="javascript"> request
   .get(url)
   .end(function(err, res){

   });</code></pre>
<p>å°±æ˜¯è¿™ä¹ˆç®€ç­”ï¼Œä½ å·²ç»å­¦ä¼šä½¿ç”¨å®ƒäº†ï¼Œåˆ«æ‡µé€¼ï¼Œè¿™ä¸‰è¡Œä»£ç ï¼Œå·²ç»å®Œå…¨å¤Ÿæˆ‘ä»¬æœ¬æ¬¡ç¤ºä¾‹çš„ä½¿ç”¨äº†ã€‚<em>é¢ï¼Œå½“ç„¶äº†ï¼Œæ›´å¤šçš„è¯·ç§»æ­¥å®˜æ–¹æ–‡æ¡£</em></p>
<ul>
<li><p><a href="http://visionmedia.github.io/superagent/">superagent</a></p></li>
<li><p>[[è¯‘] SuperAgentä¸­æ–‡ä½¿ç”¨æ–‡æ¡£](<a href="https://cnodejs.org/topic/5378720ed6e2d16149fa16bd)">https://cnodejs.org/topic/537...</a></p></li>
</ul>
<h3>åˆå‡ºèŒ…åºã€å…ˆæ‹¿ç™¾åº¦ç»ƒç»ƒæ‰‹ã€‘</h3>
<p>æˆ‘ä»¬å·²ç»ä»‹ç»äº†ä»Šå¤©çš„ä¸¤å¤§ä¸»è§’ï¼Œé‚£å°±å…ˆæ¥ç»ƒç»ƒæ‰‹ï¼Œå°±ç”¨ç™¾åº¦å§</p>
<pre><code class="javascript">const superAgent = require('superagent')
const cheerio = require('cheerio')
const URL = 'http://www.baidu.com/'

// å‘èµ·GETè¯·æ±‚
superAgent
  .get(URL) 
  .end((err, res)=&gt;{
      if(err) console.error(err)
    // ç”¨cheerioå¤„ç†è¿”å›çš„html
      const $ = cheerio.load(res.text)
    // æ‰¾åˆ°å¹¶æ‰“å°å‡ºæŒ‰é’®#suçš„å€¼
    console.log($('#su').val())  // ç™¾åº¦ä¸€ä¸‹
  })   </code></pre>
<p>ok,ç°åœ¨å·²ç»äº†è§£å¹¶èƒ½ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼Œæ›´å¤šçš„æ¢ç´¢åœ¨è‡ªå·±ï¼Œæˆ‘ä»¬åº”å½“å†ç”¨å†™æ—¶é—´å»é˜…è¯»å…¶æ–‡æ¡£ï¼Œå¯¹å…¶æœ‰æ·±å…¥çš„äº†è§£ã€‚æ¥ä¸‹æ¥å°±æ˜¯ç”¨åˆšå­¦çš„è¿™äº›çŸ¥è¯†ä¸ºä½ æ¶¨å§¿åŠ¿äº†ã€‚</p>
<h2>å¼€å§‹å¼€å‘<code>joke-cli</code>
</h2>
<h3>åˆå§‹åŒ–é¡¹ç›®</h3>
<pre><code class="bash">$ mkdir joke-cli
$ cd joke-cli
$ npm init
$ npm install cheerio superagent colors --save //colors è¾“å‡ºç¾åŒ–</code></pre>
<p>æ–°å»ºå¥½bin/index.jsæ–‡ä»¶ï¼Œå¹¶åŠ å…¥package.jsonæ–‡ä»¶ä¸­</p>
<pre><code class="json">"bin": {
    "joke-cli": "./bin/index.js"
 }</code></pre>
<p>ç°åœ¨æ‰§è¡Œ<code>npm link</code>ã€‚æˆ‘ä»¬çš„å°é¡¹ç›®å°±åˆå§‹åŒ–æˆåŠŸäº†ï¼Œå°±å¯ä»¥è®¤çœŸæ€è€ƒä»£ç äº†</p>
<h3>é¦–å…ˆåˆ†æç³—äº‹ç™¾ç§‘url</h3>
<p>æˆ‘ä»¬æ‰“å¼€ç³—äº‹ç™¾ç§‘ä¼šå‘ç°å®ƒçš„URLè¿˜æ˜¯å¾ˆç®€å•ï¼Œç”±äºæˆ‘ä»¬åªæ˜¯çˆ¬å–æ®µå­æ‰€ä»¥urlå¦‚ä¸‹<code>http://www.qiushibaike.com/text/page/2/4965899</code>ï¼Œ2å°±æ˜¯é¡µæ•°ã€‚</p>
<p><img data-src="/img/remote/1460000008740490?w=1330&amp;h=246" src="/img/remote/1460000008740490?w=1330&amp;h=246.png"></p>
<h3>å¼€å§‹ç¼–å†™index.js</h3>
<pre><code>#!/usr/bin/env node

const superAgent = require('superagent')
const cheerio = require('cheerio')

let url = 'http://www.qiushibaike.com/text/page/'
let page = 1

superAgent
    .get(url+page) 
    .end((err, res)=&gt;{
          if(err) console.error(err)
        console.log(res.text)
    })</code></pre>
<p><code>f12</code>æŸ¥çœ‹ç³—äº‹ç™¾ç§‘çš„HTMLç»“æ„ï¼Œå¯ä»¥å‘å…ˆæ¯æ¡ç¬‘è¯éƒ½åœ¨ä¸€ä¸ª<code>div.article</code>ä¸­ï¼Œç¬‘è¯çš„å†…å®¹åˆ™åœ¨<code>div.content</code>ä¸­</p>
<p><img data-src="/img/remote/1460000008740491?w=882&amp;h=286" src="/img/remote/1460000008740491?w=882&amp;h=286.png"></p>
<p>åœ¨åˆ†æå®Œhtmlç»“å¤Ÿåï¼Œç°åœ¨å¯ä»¥ç”¨æˆ‘ä»¬ç”¨cheerioå¾ˆå®¹æ˜“å°±å¯ä»¥å–å‡ºç¬‘è¯</p>
<pre><code class="javascript">Â·Â·Â·
.end((err, res)=&gt;{
  if(err) console.error(err)
  const $ = cheerio.load(res.text)
  const jokeList = $('.article .content span')
  jokeList.each(function(i, item){
    console.log($(this).text()) //å°†æ‰“å°å‡ºæ¯æ¡ç¬‘è¯
  })    
})    
Â·Â·Â·</code></pre>
<h3>å®ç°å‘½ä»¤è¡Œäº¤äº’</h3>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°readlinemæ¨¡å—</p>
<h4>Readline(é€è¡Œè¯»å–)</h4>
<blockquote><p><code>require('readline')</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨äºä»<a href="http://nodejs.cn/api/stream.html">å¯è¯»æµ</a>ï¼ˆå¦‚ <a href="http://nodejs.cn/api/process.html#process_process_stdin"><code>process.stdin</code></a>ï¼‰è¯»å–æ•°æ®ï¼Œæ¯æ¬¡è¯»å–ä¸€è¡Œã€‚ åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p></blockquote>
<p><em>ä½¿ç”¨ <code>readline.Interface</code> ç±»å®ç°ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œç•Œé¢ï¼š</em></p>
<pre><code class="javascript">const readline = require('readline');
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
  prompt: 'è¯·è¾“å…¥&gt; '
});

//rl.prompt() æ–¹æ³•ä¼šåœ¨ output æµä¸­æ–°çš„ä¸€è¡Œå†™å…¥ readline.Interface å®ä¾‹é…ç½®åçš„ promptï¼Œç”¨äºä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªå¯ä¾›è¾“å…¥çš„æ–°çš„ä½ç½®
rl.prompt();

rl.on('line', (line) =&gt; {
  switch(line.trim()) {
    case 'hello':
      console.log('world!');
      break;
    default:
      console.log(`ä½ è¾“å…¥çš„æ˜¯ï¼š'${line.trim()}'`);
      break;
  }
  rl.prompt();
}).on('close', () =&gt; {
  console.log('å†è§!');
  process.exit(0);
});</code></pre>
<p><em>æ›´å¤šå‚è€ƒ<a href="http://nodejs.cn/api/readline.html">Node.jsä¸­æ–‡ç½‘</a></em></p>
<h3>æ”¹å†™index.jså®ç°å‘½ä»¤è¡Œäº¤äº’åŠŸèƒ½</h3>
<pre><code class="javascript">#!/usr/bin/env node

const superAgent = require('superagent')
const cheerio = require('cheerio')
const readline = require('readline')
const colors = require('colors')
// åˆ›å»ºreadlinde.Interface å®ç°å‘½ä»¤è¡Œäº¤äº’
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    prompt: ' ğŸ˜†  æ‚¨æ­£åœ¨ä½¿ç”¨joke-cli,æŒ‰ä¸‹å›è½¦æŸ¥çœ‹ç¬‘è¯ ğŸ˜œ &gt;&gt;&gt;'
})
let url = 'http://www.qiushibaike.com/text/page/'
let page = 1

// ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾ç¬‘è¯
let jokeStories = []
// è½½å…¥ç¬‘è¯å¹¶å­˜å…¥æ•°ç»„ä¸­
function loadJokes(){
      // æ•°ç»„ä¸­çš„ç¬‘è¯ä¸è¶³ä¸‰æ¡æ—¶å°±è¯·æ±‚ä¸‹ä¸€é¡µçš„æ•°æ®
    if(jokeStories.length&lt;3){
        superAgent
        .get(url+page) 
        .end((err, res)=&gt;{
            if(err) console.error(err)
            const $ = cheerio.load(res.text)
            const jokeList = $('.article .content span')
            jokeList.each(function(i, item){
                jokeStories.push($(this).text()) //å­˜å…¥æ•°ç»„
            })
            page++            
        })
    }
}

rl.prompt()
loadJokes()
// lineäº‹ä»¶ æ¯å½“ input æµæ¥æ”¶åˆ°æ¥æ”¶è¡Œç»“æŸç¬¦ï¼ˆ\nã€\r æˆ– \r\nï¼‰æ—¶è§¦å‘ 'line' äº‹ä»¶ã€‚ é€šå¸¸å‘ç”Ÿåœ¨ç”¨æˆ·æŒ‰ä¸‹ &lt;Enter&gt; é”®æˆ– &lt;Return&gt; é”®ã€‚
// æŒ‰ä¸‹å›è½¦é”®æ˜¾ç¤ºä¸€æ¡ç¬‘è¯
rl.on('line', (line) =&gt; {
    if(jokeStories.length&gt;0){
        console.log('======================')
        console.log(jokeStories.shift().bgCyan.black) //ç”¨colorsæ¨¡å—æ”¹å˜è¾“å‡ºé¢œè‰²
        loadJokes()
    }else{
        console.log('æ­£åœ¨åŠ è½½ä¸­~~~'.green)
    }
    rl.prompt()
}).on('close', () =&gt; {
    console.log('Bye!')
    process.exit(0)
})</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªæ•°ç»„å­˜æ”¾ç¬‘è¯ï¼Œæ¯æŒ‰ä¸‹å›è½¦ï¼Œå°±æ˜¾ç¤ºä¸€æ¡(<code>shift()</code>åˆ é™¤å¹¶è¿”å›æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ )ï¼Œå½“æ•°ç»„ä¸­ä¸è¶³ä¸‰æ¡æ—¶å°±è¯·æ±‚æ–°çš„ä¸€é¡µ</p>
<h2>æ€»ç»“</h2>
<p>åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„joke-cliå°±å¼€å‘å®Œæˆã€‚æ­¤æ—¶æˆ‘ä»¬åº”è¯¥äº†è§£äº†superagent, cheerioï¼Œ readlineç­‰æ¨¡å—çš„ä½¿ç”¨ã€‚è¿™ä¼šå„¿åº”è¯¥è¶çƒ­æ‰“é“ï¼Œå¿«å»å¥½å¥½çœ‹çœ‹è¿™äº›æ¨¡å—å§</p>
<h2>ç›¸å…³é“¾æ¥</h2>
<ul>
<li><p><a href="http://xingxin.me">åŸæ–‡é“¾æ¥xingxin.me</a></p></li>
<li><p><a href="https://cheerio.js.org/">cheerio</a></p></li>
<li><p><a href="http://visionmedia.github.io/superagent/">superagent</a></p></li>
<li><p><a href="https://cnodejs.org/topic/5378720ed6e2d16149fa16bd">è¯‘)SuperAgentä¸­æ–‡ä½¿ç”¨æ–‡æ¡£</a></p></li>
<li><p><a href="http://nodejs.cn/api/readline.html">Node.jsä¸­æ–‡ç½‘</a></p></li>
<li><p><a href="https://github.com/marak/colors.js/">colors.js</a></p></li>
</ul>