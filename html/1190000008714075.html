具开发</h1>
<blockquote><p>NodeJs有许多命令行工具。它们全局安装，并提供一个命令供我们使用，完成相应的功能。 现在我们就用node来开发一个实用的命令行小工具</p></blockquote>
<h2>一.初探</h2>
<h3>一个最简单的命令行工具</h3>
<p>1.首先我们新建一目录，然后执行<code>npm init</code>生成package.json文件</p>
<p>2.新建一bin目录并在目录下创建一个hi.js</p>
<pre><code class="javascript">#! /usr/bin/env node
console.log("hi")</code></pre>
<p>执行<code>node hi.js</code>我们可以看到终端输出‘hi’。。当然这并不是我们要的命令行工具，我们需要直接运行<code>hi</code>就可出现结果</p>
<p>3.现在我们告诉npm可执行文件是哪个，在package.json里添加如下信息：</p>
<pre><code class="json"> "bin": {
    "hi": "bin/hi.js"
  }</code></pre>
<ol><li><p><code>npm link</code></p></li></ol>
<p>现在我们执行<code>npm link</code>启用命令行，现在再试试在终端直接输入<code>hi</code>命令，这次我们可以如愿见到结果</p>
<h3>处理参数</h3>
<p>命令行参数可通过系统变量<code>process.argv</code>获取。 <em>process.argv返回一个数组 第一个是node 第二个是脚本文件 第三个是输入的参数，</em><code>process.argv[2]</code>开始得到才是真正的参数部分</p>
<pre><code class="javascript">  #! /usr/bin/env node

let argv = process.argv.slice(2)
let yourName = argv[0]
console.log(`hi, ${yourName}!`)

// 执行 hi liu
// hi, liu!</code></pre>
<h3>Commander.js</h3>
<p>对于参数处理，我们一般使用<a href="https://github.com/tj/commander.js">commander</a>，commander是一个轻巧的nodejs模块，提供了用户命令行输入和参数解析强大功能如：自记录代码、自动生成帮助、合并短参数（“ABC”==“-A-B-C”）、默认选项、强制选项、命令解析、提示符</p>
<pre><code class="bash">$ npm install commander --save</code></pre>
<pre><code class="javascript">#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')

program
  .version('0.0.1')
  .option('-p, --peppers', 'Add peppers')
  .option('-P, --pineapple', 'Add pineapple')
  .option('-b, --bbq-sauce', 'Add bbq sauce')
  .option('-c, --cheese [type]', 'Add the specified type of cheese [marble]', 'marble')
  .parse(process.argv)

console.log('you ordered a pizza with:')
if (program.peppers) console.log('  - peppers')
if (program.pineapple) console.log('  - pineapple')
if (program.bbqSauce) console.log('  - bbq')
console.log('  - %s cheese', program.cheese)</code></pre>
<h3>Commander API</h3>
<ul>
<li><p><code>Option()</code>: 初始化自定义参数对象，设置“关键字”和“描述”</p></li>
<li><p><code>Command()</code>: 初始化命令行参数对象，直接获得命令行输入</p></li>
<li><p><code>Command#command()</code>: 定义一个命令名字</p></li>
<li><p><code>Command#action()</code>: 注册一个callback函数</p></li>
<li><p><code>Command#option()</code>: 定义参数，需要设置“关键字”和“描述”，关键字包括“简写”和“全写”两部分，以”,”,”|”,”空格”做分隔。</p></li>
<li><p><code>Command#parse()</code>: 解析命令行参数argv</p></li>
<li><p><code>Command#description()</code>: 设置description值</p></li>
<li><p><code>Command#usage()</code>: 设置usage值</p></li>
<li><p>更多参考 <a href="http://tj.github.io/commander.js/">commander官网</a></p></li>
</ul>
<p>除了commander外，<a href="http://yargs.js.org/">yargs</a>也是一个优秀的命令行参数处理模块</p>
<h2>二.开发命令行翻译工具</h2>
<h3>1.新建并初始化项目</h3>
<p>新建 文件夹translator/进入目录下执行<code>npm init</code> 生成package.json文件</p>
<pre><code class="bash">npm install commander superagent cli-table2 --save</code></pre>
<ul>
<li><p><em><a href="http://npm.taobao.org/package/cli-table2">cli-table2</a>命令行表格输出</em></p></li>
<li><p><em><a href="http://visionmedia.github.io/superagent/">superagent</a>用于http请求</em></p></li>
</ul>
<p>新建bin/translator.js文件，并加入package.json文件中</p>
<pre><code class="json"> "bin": {
    "translator": "bin/translator.js"
  },</code></pre>
<p>然后</p>
<pre><code class="bash">npm link</code></pre>
<p>这里我们会用到<a href="http://fanyi.youdao.com/openapi?path=data-mode">有道API</a><br>一切准备就绪我们就可以进行编码了</p>
<h3>2.coding</h3>
<p><em>由于代码量很小，这里就直接贴代码，在代码中以注释讲解</em></p>
<pre><code class="javascript">#! /usr/bin/env node
// 引入需要的模块
const program = require('commander')
const Table = require('cli-table2') // 表格输出
const superagent = require('superagent') // http请求
// 初始化commander
program
    .allowUnknownOption()
    .version('0.0.1')
    .usage('translator &lt;cmd&gt; [input]')

// 有道api
const API = 'http://fanyi.youdao.com/openapi.do?keyfrom=toaijf&amp;key=868480929&amp;type=data&amp;doctype=json&amp;version=1.1'

// 添加自定义命令
program
    .command('query')
    .description('翻译输入')
    .action(function(word) {
        // 发起请求
        superagent.get(API)
        .query({ q: word})
        .end(function (err, res) {
            if(err){
                console.log('excuse me, try again')
                return false
            }
            let data = JSON.parse(res.text)
            let result = {}

            // 返回的数据处理
            if(data.basic){
                result[word] = data['basic']['explains']
            }else if(data.translation){
                result[word] = data['translation']
            }else {
                console.error('error')
            }

            // 输出表格
            let table = new Table()
            table.push(result)
            console.log(table.toString())
        })
    })

// 没有参数时显示帮助信息
if (!process.argv[2]) {
    program.help();
    console.log();
}

program.parse(process.argv)</code></pre>
<p>现在在终端中愉快的使用<code>translator</code>了</p>
<pre><code>$ translator
Usage:  translator &lt;cmd&gt; [input]
  Commands:
    query   翻译输入
  Options:
    -h, --help     output usage information
    -V, --version  output the version number</code></pre>
<h2>三.小结</h2>
<ol>
<li><p>了解nodeJs 可执行脚步</p></li>
<li><p>了解命令行参数解析</p></li>
<li><p>了解commander,cli-table2,superagent等第三方模块</p></li>
</ol>
<p><em>抛砖引玉，更多请参考各个模块的官方示例及API文档</em></p>
<h3>相关链接</h3>
<ul>
<li><p><a href="http://tj.github.io/commander.js/#Command.prototype.parseExpectedArgs">CommanderJs</a></p></li>
<li><p><a href="http://npm.taobao.org/package/cli-table2">cli-table2</a></p></li>
<li><p><a href="http://visionmedia.github.io/superagent/">superagent</a></p></li>
<li><p><a href="http://www.ruanyifeng.com/blog/2015/05/command-line-with-node.html">Node.js 命令行程序开发教程-阮一峰</a></p></li>
<li><p><a href="http://blog.fens.me/nodejs-commander/">Commander写自己的Nodejs命令-粉丝日志</a></p></li>
<li><p><a href="http://xingxin.me">原文链接：xingxin.me</a><