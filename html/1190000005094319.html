<h2>前言</h2>
<p>说起box-shadow那第一个想法当然就是用来实现阴影，其实它还能用于实现其他好玩的效果的，本篇就打算说说box-shadow的那些事。</p>
<h2>二话不说看效果</h2>
<p><img data-src="/img/remote/1460000006781652" src="/img/remote/1460000006781652.png"><br><em>3D小球</em></p>
<pre><code>&lt;style type="text/css"&gt;
.ball{
  background: rgba(100,100,100,0.2);
  width: 100px;
  height: 100px;
  padding: 10px;
  border-radius: 50%;
  box-shadow: -14px 8px 100px #333 inset, 
              0 0 2px #888,
          3px -1px 4px #444;
}
&lt;/style&gt;
&lt;div class="ball"&gt;&lt;/div&gt;</code></pre>
<p><img data-src="/img/remote/1460000005094324" src="/img/remote/1460000005094324.png"><br><em>纸张阴影(来自@张鑫旭老师)</em></p>
<pre><code>&lt;style type="text/css"&gt;
.curved_box {
    display: inline-block;
    *display: inline;
    width: 200px;
    height: 248px;
    margin: 20px;
    background-color: #fff;
    border: 1px solid #eee;
    -webkit-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.27), 0 0 60px rgba(0, 0, 0, 0.06) inset;
    -moz-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.27), 0 0 40px rgba(0, 0, 0, 0.06) inset; 
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.27), 0 0 40px rgba(0, 0, 0, 0.06) inset;
    position: relative;
    *zoom: 1;
}

.curved_box:before {
    -webkit-transform: skew(-15deg) rotate(-6deg);
    -moz-transform: skew(-15deg) rotate(-6deg);
    transform: skew(-15deg) rotate(-6deg);
    left: 15px;
}
.curved_box:after {
    -webkit-transform: skew(15deg) rotate(6deg);
    -moz-transform: skew(15deg) rotate(6deg);
    transform: skew(15deg) rotate(6deg);
    right: 15px;
}

.curved_box:before, .curved_box:after {
    width: 70%;
    height: 55%;
    content: ' ';
    
    -webkit-box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    -moz-box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); 
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    
    position: absolute;
    bottom: 10px;
    z-index: -1;    
}
&lt;/style&gt;
&lt;div class="curved_box"&gt;&lt;/div&gt;</code></pre>
<h2>细读属性</h2>
<p>看到上面这么绚丽的效果，是不是迫不及待想弄清box-shadow呢？下面我们来一步步解密它吧！</p>
<h3>概述属性语法</h3>
<pre><code>box-shadow: none | &lt;shadow&gt;[,&lt;shadow&gt;]*</code></pre>
<p>默认值为<code>none</code></p>
<pre><code>&lt;shadow&gt;`:`inset? &amp;&amp; &lt;length&gt;{2,4} &amp;&amp; &lt;color&gt;?</code></pre>
<ul>
<li><p><strong>shadow pattern</strong> 默认为outset，即采用outer box-shadow。通过设置为inset时，则采用inner box-shadow。</p></li>
<li><p><strong>horizontal offset</strong> 阴影距离原位置的水平位移，正数表示向右移动，负数表示向左移动。</p></li>
<li><p><strong>vertical offset</strong> 阴影距离原位置的垂直位移，正数表示向下移动，负数表示向上移动。</p></li>
<li><p><strong>blur radius</strong> 默认值为0，阴影模糊度半径。</p></li>
<li><p><strong>spread distance</strong> 默认值为0，扩展或缩小阴影的作用面积。</p></li>
<li><p><strong><code>&lt;color&gt;</code></strong> 阴影颜色，默认与<code>color</code>属性一致。</p></li>
</ul>
<p>注意：我们可以同时设置多个阴影，而阴影的z-index值从左向右递减。</p>
<h3>outer box-shadow 和 inner box-shadow怎么玩？</h3>
<p>默认情况下采用的是outer box-shadow，当在<code>box-shadow</code>中添加inset关键词后，则采用inner box-shadow了，但到底它俩的效果是如何的呢？</p>
<p><img data-src="/img/remote/1460000005094329" src="/img/remote/1460000005094329.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.box{
  float: left;

  background: #888;
  width: 100px;
  height: 100px;
  margin-right: 20px;
}
.outer-box-shadow{
  box-shadow: 10px 10px #F00;
}
.inner-box-shadow{
  box-shadow: 10px 10px #F00 inset;
}
&lt;/style&gt;
&lt;div class="box outer-box-shadow"&gt;&lt;/div&gt;
&lt;div class="box inner-box-shadow"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
<p><strong>outer-box-shadow</strong></p>
<p>特点：阴影落在元素的border box之外。</p>
<p>实现原理：</p>
<ol>
<li><p>创建一个与元素border box尺寸一致的阴影盒子;</p></li>
<li><p>将阴影盒子定位到于元素border box重合，并位于元素之下;</p></li>
<li><p>根据<code>horizontal offset</code>和<code>vertical offset</code>来相对原位置作移动;</p></li>
<li><p>根据<code>spread distance</code>缩放阴影盒子的尺寸（会改变盒子的位移）;</p></li>
<li><p>根据<code>blur radius</code>对阴影盒子作加工;</p></li>
<li><p>最后将阴影盒子与元素border box重合部分剪切掉。</p></li>
</ol>
<p><img data-src="/img/remote/1460000005094333" src="/img/remote/1460000005094333.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.box{
  background: #888;
  width: 100px;
  height: 100px;
}
.outer-box-shadow{
  box-shadow: 90px 10px #F00;
}
&lt;/style&gt;
&lt;div class="box outer-box-shadow"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>模拟一下：</p>
<p><img data-src="/img/remote/1460000005094344" src="/img/remote/1460000005094344.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.box{
  position: relative;
}
.box-shadow{
  position: absolute;
  z-index: -1;
  background: #F00;
  width: 100px;
  height: 100px;
  left: 20px;
  top: 20px;
}
.box-content{
  background: #888;
  width: 100px;
  height: 100px;
}
&lt;/style&gt;
&lt;div class="box"&gt;
  &lt;div class="box-shadow"&gt;&lt;/div&gt;
  &lt;div class="box-content"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
<p><strong>inner-box-shadow</strong></p>
<p>特点：阴影落在元素的padding box之内。</p>
<p>实现原理(纯个人理解)：</p>
<ol>
<li><p>创建一个与元素padding box尺寸一致的阴影盒子;</p></li>
<li><p>将阴影盒子定位到于元素padding box重合，并位于元素之上;</p></li>
<li><p>水平和垂直各画两条线，分别跟元素padding edge重合;(共4条分别记为left/top/right/bottom-guideline)</p></li>
<li><p>根据<code>horizontal offset</code>和<code>vertical offset</code>移动left/top/right/bottom-guideline。</p></li>
<li><p>根据<code>spread distance</code>移动4条线。spread distance为正数时，left-guideline向右移动，top-guideline向下移动，right-guideline向左移动和bottom-guidelien向上移动；spread distance为负数时，则相反。</p></li>
<li><p>根据<code>blur radius</code>加工元素各padding edge至其对应的guideline间的区域.</p></li>
<li>
<p>对阴影盒子进行剪裁</p>
<ol>
<li><p>剪切掉不与元素padding box重叠的部分；</p></li>
<li><p>仅显示元素各padding edge至其对应的guideline间的区域。</p></li>
</ol>
</li>
</ol>
<p><img data-src="/img/remote/1460000005094346" src="/img/remote/1460000005094346.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.box{
  float: left;
  background: #888;
  width: 100px;
  height: 100px;
  margin-right: 10px;
}
.box1{
  box-shadow: 0 0 0 20px red inset;
}
.box2{
  box-shadow: 10px 0 0 20px red inset;
}
.box3{
  box-shadow: 10px 0 10px 20px red inset;
}
.box4{
  box-shadow: 0 0 10px 50px red inset;
}
&lt;/style&gt;
&lt;div class="box box1"&gt;&lt;/div&gt;
&lt;div class="box box2"&gt;&lt;/div&gt;
&lt;div class="box box3"&gt;&lt;/div&gt;
&lt;div class="box box4"&gt;&lt;/div&gt;</code></pre>
<p>模拟一下：</p>
<p><img data-src="/img/remote/1460000005094348" src="/img/remote/1460000005094348.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.box-shadow{
  position: relative;
  display: inline-block;
  background: red;
  overflow: hidden;
}
.bg{
  position: absolute;
  background: #888;
  left: 30px;
  right: 10px;
  top: 20px;
  bottom: 20px;
}
.content{
  position: relative;
  z-index: 1;
  width: 80px;
  height: 80px;
  padding: 20px;
}
&lt;/style&gt;
&lt;div class="box-shadow"&gt;
  &lt;div class="bg"&gt;&lt;/div&gt;
  &lt;div class="content"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
<h3>模糊边框 by <code>blur radius</code>
</h3>
<p>W3C spec中没有规定浏览器厂商使用哪种方式实现模糊效果，反正效果与高斯模糊效果差不多就是了。但有一点我们需要注意的，那就是<strong>模糊效果会扩大阴影的面积</strong>。</p>
<p><img data-src="/img/remote/1460000005094342" src="/img/remote/1460000005094342.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.outline{
  border: 1px solid red;
  margin: 40px 0;
}
.s{
  background: rgba(255, 100, 100, 0.1);
  width: 100px;
  height: 100px;
}
.s1{
  box-shadow: 110px 0 0 #333;
}
.s2{
  box-shadow: 110px 0 20px #333;
}
.s3{
  box-shadow: 110px 0 40px #333;
}
&lt;/style&gt;
&lt;div class="outline"&gt;
  &lt;div class="s s1"&gt;sample1&lt;/div&gt;
&lt;/div&gt;
&lt;div class="outline"&gt;
  &lt;div class="s s2"&gt;sample2&lt;/div&gt;
&lt;/div&gt;
&lt;div class="outline"&gt;
  &lt;div class="s s3"&gt;sample3&lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>sample1是<code>blur radius</code>为0的效果，可以看到阴影尺寸与元素尺寸一模一样。而sample2是<code>blur radius</code>为20px的效果，可以看到阴影尺寸有所扩展了，而sample3则扩展得更多一些。</p>
<p>现在我们感性上认知到<code>blur radius</code>值大于0时会扩展阴影尺寸，那么到底扩展多少呢？那我们要先明确模糊发生的起始位置了。</p>
<ol>
<li><p>对于outer-shadow-box而言，模糊发生的起始位置就是阴影盒子的各边；</p></li>
<li><p>对于inner-shadow-box而言，模糊发生的起始位置就是各guideline。</p></li>
</ol>
<p>然后模糊效果是从发生的位置，对于水平方向的边或guideline则向垂直方向发散，对于垂直方向的边或guideline则向水平方向发散，且发散的距离相同。</p>
<p>发散的距离相同，因此每个方向各发散为<strong><code>blur radius/2</code></strong>的距离。看sample3中阴影尺寸已经与元素盒子重叠了，因为阴影盒子左边框向左发散了20px了，超过它俩之间10px的水平距离了，而sample2则恰恰邻近而已。</p>
<h3>缩放阴影尺寸 by <code>spread distance</code>
</h3>
<p>如果说<code>blur radius</code>是暗地里扩大阴影的尺寸，那么<code>spread distance</code>则是明目张胆地缩放阴影的尺寸了。</p>
<p><img data-src="/img/remote/1460000005094350" src="/img/remote/1460000005094350.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.outline{
  border: 1px solid red;
  margin: 40px 0;
}
.s{
  background: rgba(255, 100, 100, 0.1);
  width: 100px;
  height: 100px;
}
.s1{
  box-shadow: 110px 0 0 #333;
}
.s2{
  box-shadow: 110px 0 0 10px #333;
}
.s3{
  box-shadow: 110px 0 0 -10px #333;
}
&lt;/style&gt;
&lt;div class="outline"&gt;
  &lt;div class="s s1"&gt;sample1&lt;/div&gt;
&lt;/div&gt;
&lt;div class="outline"&gt;
  &lt;div class="s s2"&gt;sample2&lt;/div&gt;
&lt;/div&gt;
&lt;div class="outline"&gt;
  &lt;div class="s s3"&gt;sample3&lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>还记得<a href="http://www.cnblogs.com/fsjohnhuang/p/5436087.html">《CSS魔法堂：重拾Border之——解构Border》</a>中提及通过<code>border-top/right/bottom/left-colors</code>实现彩虹边框吗？由于兼容性问题和1px对应一种color的缘故，实际应用得很少，但通过outer-box-shadow和<code>spread distance</code>我们就可以得到效果更好，兼容性很高的实现方案了。</p>
<p><img data-src="/img/remote/1460000005094352" src="/img/remote/1460000005094352.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.rainbow{
  margin: 50px;
  width: 100px;
  height: 100px;
  box-shadow: 0 0 0 2px rgb(255,0,0),
              0 0 0 5px rgb(255,165,0),
              0 0 0 8px rgb(255,255,0),
              0 0 0 10px rgb(0,255,0),
              0 0 0 12px rgb(0,127,255),
              0 0 0 15px rgb(0,0,255),
              0 0 0 20px rgb(139,0,255);
}
&lt;/style&gt;
&lt;div class="rainbow"&gt;&lt;/div&gt;</code></pre>
<h3>弄清各图层的z-index</h3>
<p><img data-src="/img/remote/1460000005094354" src="/img/remote/1460000005094354.jpeg"></p>
<p>上图可以看到没有阴影时，各图层的z-index顺序。那么阴影呢？</p>
<ol>
<li><p>对于outer-box-shadow，则其z-index高于margin图层，低于background-color图层;</p></li>
<li><p>对于inner-box-shadow，则其z-index高于padding图层，低于content图层。</p></li>
</ol>
<h3>阴影的position</h3>
<p>通过<code>horizontal/vertical offset</code>重定位阴影盒子，通过<code>blur radius</code>或<code>spread distance</code>缩放阴影盒子的尺寸，但请注意的是<strong>阴影盒子不影响其他盒子的布局</strong>，其实阴影盒子就相当于采用absolute定位一样，不会占据Normal flow的空间，也不会影响其他元素的布局，因此仅修改阴影位置或尺寸时，只会触发repaint，而不会触发reflow。</p>
<h2>圆角or直角box-shadow傻傻分不清楚？</h2>
<p>阴影不仅默认尺寸与元素盒子一致，默认形状也一致。也就是元素盒子采用圆角时，阴影的默认形状也是圆角的。既然说是默认形状一致，就是说可以不一致咯！那到底如何不一致呢，下面我们一起来看个究竟吧！</p>
<p><img data-src="/img/remote/1460000005094355" src="/img/remote/1460000005094355.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.s1{
  background: #0EF;
  width: 100px;
  height: 100px;
  border-radius: 10px;
  box-shadow: 110px 0 0 -10px #333,
        220px 0 0 0 #666,
        360px 0 0 20px #888;
}
&lt;/style&gt;
&lt;div class="s1"&gt;sample1&lt;/div&gt;</code></pre>
<p>当设置<code>spread distance</code>后，border-radius的值也将随之变化，具体公式为<code>border-radius + spread-distance * (1 + (border-radius / spread-distance - 1)^3)</code>。<br>因此<code>spread distance</code>为正数时，border-radius会变大; 而<code>spread distance</code>为负数时，border-radius会减小，直至为0px为止。</p>
<h2>被割裂的box-shadow</h2>
<p>当设置box-shadow的盒子被拆分为多个盒子时，其对应的box-shadow又会如何呢？其实这不仅仅是box-shadow的问题，如border、background-image等均会遇到同样的问题。CSS3中引入一个新特性<code>box-decoration-break</code>来设置上述情况时的渲染效果。</p>
<pre><code>box-decoration-break: slice | clone</code></pre>
<ul>
<li><p><strong>slice</strong>是默认值，表示首先按未拆分时的状态渲染border、background-image等样式，然后再将其直接拆分为多个盒子;</p></li>
<li><p><strong>clone</strong>表示首先将其直接拆分为多个盒子，然后再逐个盒子渲染border、background-image等样式。</p></li>
</ul>
<p><img data-src="/img/remote/1460000005094357" src="/img/remote/1460000005094357.png"></p>
<pre><code>&lt;style type="text/css"&gt;
.intro{
  font-size: 14px;
  line-height: 1.5;
  text-indent: 1em;
  width: 300px;
}
.intro span{
  border: 1px solid #666;
  border-radius: 5px;
  box-shadow: 5px 3px 3px #AAA;
}
.slice{
  -webkit-box-decoration-break: slice;
}
.clone{
  -webkit-box-decoration-break: clone;
}
&lt;/style&gt;
&lt;p class="intro"&gt;
&lt;span class="slice"&gt;
Hey there, welcome to be here to share something aboute CSS together:) My name is fsjohnhuang, a FE from Midea. Enjoy the evolution of FE, and feel excited in the work I'm doing now.
&lt;/span&gt;
&lt;/p&gt;
&lt;p class="intro"&gt;
&lt;span class="clone"&gt;
Hey there, welcome to be here to share something aboute CSS together:) My name is fsjohnhuang, a FE from Midea. Enjoy the evolution of FE, and feel excited in the work I'm doing now.
&lt;/span&gt;
&lt;/p&gt;</code></pre>
<p>从上面可以看到，与其说<code>box-decoration-break</code>的属性值影响<code>box-shadow</code>的效果，还不如说是<code>box-decoration-break</code>的属性值影响<code>border-radius</code>和<code>border</code>作用到元素盒子的效果，然后由盒子的效果再间接影响<code>box-shadow</code>的效果。</p>
<p><strong>兼容性</strong></p>
<p><img data-src="/img/remote/1460000005094359" src="/img/remote/1460000005094359.png"></p>
<p>IE和Edge均不支持，FF支持得最好，而Webkit内核的则要加-webkit-前缀。对于不支持的浏览器，其效果如同<code>box-decoration-break:slice</code>。</p>
<h2>兼容性</h2>
<p><img data-src="/img/remote/1460000005094361" src="/img/remote/1460000005094361.png"></p>
<p>IE9都支持<code>box-shadow</code>多让人可喜可贺的消息啊（因为我工作中只需兼容IE9+就Ok了:)）。但IE6~8呢？方案很多啦，上面也有简单的介绍到。@张鑫旭老师提到在模拟blur radius效果时，采用以下方案</p>
<pre><code>.ieBlock{
    height:100px;
    width:100px;
    background:#000;
    filter:progid:DXImageTransform.Microsoft.Blur(pixelradius=10);
    -ms-filter:"progid:DXImageTransform.Microsoft.Blur(pixelradius=10)"; 
}</code></pre>
<p>要比采用以下方案要好！</p>
<pre><code>.shadow {
    -moz-box-shadow: 3px 3px 4px #000;
    -webkit-box-shadow: 3px 3px 4px #000;
    box-shadow: 3px 3px 4px #000;
    /* For IE 8 */
    -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#000000')";
    /* For IE 5.5 - 7 */
    filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#000000');
}</code></pre>
<p>另外若想不假思索地用到生产环境中，还是用成熟的CSS库较好。具体请参考 <a href="http://www.zhangxinxu.com/wordpress/2010/07/pie%E4%BD%BFie%E6%94%AF%E6%8C%81css3%E5%9C%86%E8%A7%92%E7%9B%92%E9%98%B4%E5%BD%B1%E4%B8%8E%E6%B8%90%E5%8F%98%E6%B8%B2%E6%9F%93/">PIE使IE支持CSS3圆角盒阴影与渐变渲染</a>。</p>
<h2>总结</h2>
<p>尊重原创，转载请注明来自：<a href="http://www.cnblogs.com/fsjohnhuang/p/5477194.html%5E_%5E">http://www.cnblogs.com/fsjohnhuang/p/5477194.html^_^</a>肥仔John</p>
<h2>感谢</h2>
<p><a href="https://www.w3.org/TR/css3-background/#the-box-shadow">the-box-shadow</a><br><a href="https://www.w3.org/TR/2014/WD-css3-break-20140116/#break-decoration">break-decoration</a><br><a href="http://www.zhangxinxu.com/wordpress/2010/12/css3-box-shadow%E5%AE%9E%E7%8E%B0%E7%BA%B8%E5%BC%A0%E7%9A%84%E6%9B%B2%E7%BA%BF%E6%8A%95%E5%BD%B1%E6%95%88%E6%9E%9C/">CSS3 box-shadow实现纸张的曲线投影效果</a><br><a href="http://www.zhangxinxu.com/wordpress/2010/04/css%E5%AE%9E%E7%8E%B0%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E7%9A%84%E7%9B%92%E9%98%B4%E5%BD%B1%E6%95%88%E6%9E%9C/">CSS实现跨浏览器兼容性的盒阴影效果</a><br><a href="http://www.zhangxinxu.com/wordpress/2010/07/css%E5%AE%9E%E7%8E%B0%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84box-shadow%E7%9B%92%E9%98%B4%E5%BD%B1%E6%95%88%E6%9E%9C2/">CSS实现跨浏览器的box-shadow盒阴影效果(2)</a><br><a href="http://www.zhangxinxu.com/wordpress/2010/07/pie%E4%BD%BFie%E6%94%AF%E6%8C%81css3%E5%9C%86%E8%A7%92%E7%9B%92%E9%98%B4%E5%BD%B1%E4%B8%8E%E6%B8%90%E5%8F%98%E6%B8%B2%E6%9F%93/">PIE使IE支持CSS3圆角盒阴影与渐变渲染</a><br>《图解CSS3核心技术与案例实战》 —— 3.5 CSS3盒子阴影属性</p>