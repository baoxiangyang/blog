pack</code>æä¾›çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½å°±æ˜¯<code>code spliting(ä»£ç åˆ‡å‰²)</code>ã€‚</p>
<p>åœ¨<code>webpack 1.x</code>ä¸­æä¾›äº†</p>
<pre><code class="javascript">    require.ensure([], () =&gt; {
        let module = require('./page1/module');
        // do something
    }, 'module1')</code></pre>
<p>åˆ©ç”¨<code>require.ensure</code>è¿™ä¸ª<code>API</code>ä½¿å¾—<code>webpack</code>å•ç‹¬å°†è¿™ä¸ªæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå¯ä»¥å¼‚æ­¥åŠ è½½çš„<code>chunk</code>.</p>
<p>å…·ä½“çš„å¥—è·¯è§æˆ‘å†™çš„å¦ä¸€ç¯‡blog: <a href="https://segmentfault.com/a/1190000007962830">webpackåˆ†åŒ…åŠå¼‚æ­¥åŠ è½½å¥—è·¯</a></p>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼š</p>
<p>åœ¨è¾“å‡ºçš„<code>runtime</code>ä»£ç ä¸­,åŒ…å«äº†å¼‚æ­¥<code>chunk</code>çš„<code>id</code>åŠ<code>chunk name</code>çš„æ˜ å°„å…³ç³»ã€‚éœ€è¦å¼‚æ­¥åŠ è½½ç›¸åº”çš„<code>chunk</code>æ—¶ï¼Œé€šè¿‡ç”Ÿæˆ<code>script</code>æ ‡ç­¾ï¼Œç„¶åæ’å…¥åˆ°<code>DOM</code>ä¸­å®Œæˆ<code>chunk</code>çš„åŠ è½½ã€‚é€šè¿‡<code>JSONP</code>,<code>runtime</code>ä¸­å®šä¹‰å¥½å‡½æ•°ï¼Œ<code>chunk</code>åŠ è½½å®Œæˆåå³ä¼šç«‹å³æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p>
<p>ä»ç¼–è¯‘ç”Ÿæˆåçš„ä»£ç æ¥çœ‹ï¼Œ<code>webpack 1.x</code>ä»<code>chunk</code>çš„åŠ è½½åˆ°æ‰§è¡Œçš„è¿‡ç¨‹å¤„ç†çš„æ¯”è¾ƒç²—ç³™ï¼Œä»…ä»…æ˜¯é€šè¿‡æ·»åŠ <code>script</code>æ ‡ç­¾ï¼Œå¼‚æ­¥åŠ è½½<code>chunk</code>åï¼Œå®Œæˆå‡½æ•°çš„æ‰§è¡Œã€‚</p>
<p><strong>è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œå¦‚æœå‡ºç°äº†<code>chunk</code>åŠ è½½ä¸æˆåŠŸæ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹åº”è¯¥å¦‚ä½•å»å®¹é”™å‘¢ï¼Ÿ</strong></p>
<p>åœ¨<code>webpack2</code>ä¸­ç›¸æ¯”äº<code>webpack1.x</code>åœ¨è¿™ä¸ªç‚¹çš„å¤„ç†ä¸Šæ˜¯å°†<code>chunk</code>çš„åŠ è½½åŒ…è£¹åœ¨äº†<code>promise</code>å½“ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å˜çš„å¯æ§èµ·æ¥ã€‚å…·ä½“çš„<code>webpack2</code>å®ç°å¥—è·¯ä¹Ÿæ˜¯æœ¬æ–‡æƒ³è¦å»è¯´æ˜çš„åœ°æ–¹ã€‚</p>
<p><code>webpack</code>æä¾›çš„å¼‚æ­¥åŠ è½½å‡½æ•°æ˜¯</p>
<pre><code class="javascript">    /******/     // This file contains only the entry chunk.
/******/     // The chunk loading function for additional chunks
            // runtimeä»£ç é‡Œé¢åªåŒ…å«äº†å…¥å£çš„chunk
            // è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨:
            // 1. å¼‚æ­¥åŠ è½½chunk
            // 2. æä¾›å¯¹äºchunkåŠ è½½å¤±è´¥æˆ–è€…å¤„äºåŠ è½½ä¸­çš„å¤„ç†
            // å…¶ä¸­chunkåŠ è½½çŠ¶æ€çš„åˆ¤æ–­æ˜¯æ ¹æ®installedChunkså¯¹è±¡chunkIdæ˜¯æ•°å­—0è¿˜æ˜¯æ•°ç»„æ¥è¿›è¡Œåˆ¤æ–­çš„
/******/     __webpack_require__.e = function requireEnsure(chunkId) {
                // æ•°å­—0ä»£è¡¨chunkåŠ è½½æˆåŠŸ
/******/         if(installedChunks[chunkId] === 0)  
/******/             return Promise.resolve();

/******/         // an Promise means "currently loading".
                // å¦‚æœinstalledChunks[chunkId]ä¸ºä¸€ä¸ªæ•°ç»„
/******/         if(installedChunks[chunkId]) {
                    // è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡
/******/             return installedChunks[chunkId][2];
/******/         }
/******/         // start chunk loading
                // é€šè¿‡ç”Ÿæˆscriptæ ‡ç­¾æ¥å¼‚æ­¥åŠ è½½chunk.æ–‡ä»¶åæ˜¯æ ¹æ®æ¥å—çš„chunkIdæ¥ç¡®è®¤çš„
/******/         var head = document.getElementsByTagName('head')[0];
/******/         var script = document.createElement('script');
/******/         script.type = 'text/javascript';
/******/         script.charset = 'utf-8';
/******/         script.async = true;
                // è¶…æ—¶æ—¶é—´ä¸º120s
/******/         script.timeout = 120000;

/******/         if (__webpack_require__.nc) {
/******/             script.setAttribute("nonce", __webpack_require__.nc);
/******/         }
                // éœ€è¦åŠ è½½çš„æ–‡ä»¶å
/******/         script.src = __webpack_require__.p + "js/register/" + ({"2":"index"}[chunkId]||chunkId) + ".js";
                // 120sçš„å®šæ—¶å™¨ï¼Œè¶…æ—¶åè§¦å‘onScriptCompleteå›è°ƒ
/******/         var timeout = setTimeout(onScriptComplete, 120000);
                // chunkåŠ è½½å®Œæ¯•åçš„å›è°ƒ
/******/         script.onerror = script.onload = onScriptComplete;
/******/         function onScriptComplete() {
/******/             // avoid mem leaks in IE.
/******/             script.onerror = script.onload = null;
                    // æ¸…ç©ºå®šæ—¶å™¨
/******/             clearTimeout(timeout);
                    // è·å–è¿™ä¸ªchunkçš„åŠ è½½çŠ¶æ€
                    // è‹¥ä¸ºæ•°å­—0ï¼Œè¡¨ç¤ºåŠ è½½æˆåŠŸ
                    // è‹¥ä¸ºä¸€ä¸ªæ•°ç»„, è°ƒç”¨æ•°ç»„çš„ç¬¬2ä¸ªå…ƒç´ ï¼ˆç¬¬äºŒä¸ªå…ƒç´ ä¸ºpromiseå†…ä¼ å…¥çš„rejectå‡½æ•°ï¼‰ï¼Œä½¿å¾—promiseæ•è·æŠ›å‡ºçš„é”™è¯¯ã€‚reject(new Error('xxx'))
/******/             var chunk = installedChunks[chunkId];
/******/             if(chunk !== 0) {
/******/                 if(chunk) chunk[1](new Error('Loading chunk ' + chunkId + ' failed.'));
/******/                 installedChunks[chunkId] = undefined;
/******/             }
/******/         };
                
                // æ¯æ¬¡éœ€è¦è¿›è¡Œå¼‚æ­¥åŠ è½½chunkæ—¶ï¼Œä¼šå°†è¿™ä¸ªchunkçš„åŠ è½½çŠ¶æ€è¿›è¡Œåˆå§‹åŒ–ä¸ºä¸€ä¸ªæ•°ç»„,å¹¶ä»¥key/valueçš„å½¢å¼ä¿å­˜åœ¨installedChunksé‡Œ
                // è¿™ä¸ªæ•°ç»„ä¸º[resolve, reject, promise];
/******/         var promise = new Promise(function(resolve, reject) {
/******/             installedChunks[chunkId] = [resolve, reject];
/******/         });
/******/         installedChunks[chunkId][2] = promise;

/******/         head.appendChild(script);
                //è¿”å›promise
/******/         return promise;
/******/     };</code></pre>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è·¯ç”±é…ç½®æ–‡ä»¶ç¼–è¯‘åç”Ÿæˆçš„ä»£ç <code>index.js</code>, ç‰¹åˆ«æ³¨æ„ä¸‹<code>__webpack_require__.e</code>è¿™ä¸ªå¼‚æ­¥åŠ è½½å‡½æ•°ï¼š</p>
<pre><code class="javascript">Router
.home('path1')
.addRoute({
    path: 'path1',
    animate: 'zoomIn',
    viewBox: '.public-path1-container',
    template: __webpack_require__(5),
    //  æŒ‚è½½controller
    pageInit: function pageInit() {
        var _this = this;

        console.time('route async path1');
        // å¼‚æ­¥åŠ è½½0.js(è¿™ä¸ªæ–‡ä»¶æ˜¯webpacké€šè¿‡code splitingè‡ªå·±ç”Ÿæˆçš„æ–‡ä»¶å)
        // å…·ä½“å¼‚æ­¥åŠ è½½ä»£ç çš„å°è£…è§ğŸ‘†åˆ†æ
        // å…¶ä¸­0.jsåŒ…å«äº†åŒ…å«äº†path1è¿™ä¸ªè·¯ç”±ä¸‹çš„ä¸šåŠ¡ä»£ç 
        // __webpack_require__.e(0) èµ·çš„ä½œç”¨ä»…ä¸ºåŠ è½½chunkä»¥åŠæä¾›å¯¹äºchunkåŠ è½½å¤±è´¥é”™è¯¯çš„æŠ›å‡º
        // å…·ä½“çš„ä¸šåŠ¡ä»£ç çš„è§¦å‘æ˜¯é€šè¿‡__webpack_require_e(0).then(__webpack_require__.bind(null, 8)).then(function(module) { ... })è¿›è¡Œè§¦å‘
        // __webpack_require__.bind(null, 8) è¿”å›çš„æ˜¯module[8]æš´éœ²å‡ºæ¥çš„module
        // è¿™æ®µä»£ç æ‰§è¡Œæ—¶,é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªmoduleå¯¹è±¡
        // module = {
        //        i: moduleId,  // æ¨¡å—id
        //        l: false,     // åŠ è½½çŠ¶æ€
        //        exports: {}   // éœ€è¦æš´éœ²çš„å¯¹è±¡
        //    }
        // é€šè¿‡å¼‚æ­¥åŠ è½½çš„chunkæœ€åæš´éœ²å‡ºæ¥çš„å¯¹è±¡æ˜¯ä½œä¸ºäº†module.exports.defaultå±æ€§
        // å› æ­¤åœ¨ç¬¬äºŒä¸ªæ–¹æ³•ä¸­ä¼ å…¥çš„å¯¹è±¡çš„defaultå±æ€§æ‰æ˜¯ä½ æ¨¡å—8çœŸæ­£æ‰€æš´éœ²çš„å¯¹è±¡
        __webpack_require__.e/* import() */(0).then(__webpack_require__.bind(null, 8)).then(function (module) {
            var controller = module.default;
            Router.registerCtrl('path1', new controller(_this.viewBox));
        // æ·»åŠ é”™è¯¯å¤„ç†å‡½æ•°ï¼Œç”¨ä»¥æ•è·å‰é¢å¯èƒ½æŠ›å‡ºçš„é”™è¯¯
        }).catch(function (e) {
            return console.log('chunk loading failed');
        });
    },

    //  è¿›å…¥è·¯ç”±è·³è½¬ä¹‹å‰
    beforeEnter: function beforeEnter() {},

    //  è·¯ç”±è·³è½¬å‰
    beforeLeave: function beforeLeave() {}
})
.addRoute({
    path: 'path2',
    viewBox: '.public-path2-container',
    animate: 'zoomIn',
    template: __webpack_require__(6),
    pageInit: function pageInit() {
        var _this2 = this;

        __webpack_require__.e/* import() */(1).then(__webpack_require__.bind(null, 9)).then(function (module) {
            console.time('route async path2');
            var controller = module.default;
            Router.registerCtrl('path2', new controller(_this2.viewBox));
        }).catch(function (e) {
            return console.log('chunk loading failed');
        });
    },
    beforeEnter: function beforeEnter() {},
    beforeLeave: function beforeLeave() {}
});

Router.bootstrap();</code></pre>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯:</p>
<p><code>webpack2</code>ç›¸æ¯”äº<code>webpack1.x</code>å°†å¼‚æ­¥åŠ è½½<code>chunk</code>çš„è¿‡ç¨‹å°è£…åœ¨äº†<code>promise</code>å½“ä¸­,å¦‚æœ<code>chunk</code>åŠ è½½è¶…æ—¶æˆ–è€…å¤±è´¥ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æŠ›å‡ºçš„é”™è¯¯åšç›¸åº”çš„é”™è¯¯å¤„ç†ã€‚</p>
<p>æ­¤å¤–è¿˜åº”è¯¥æ³¨æ„ä¸‹,<code>webpack2</code>å¼‚æ­¥åŠ è½½<code>chunk</code>æ˜¯åŸºäºåŸç”Ÿçš„<code>promise</code>ã€‚å¦‚æœéƒ¨åˆ†ç¯å¢ƒæš‚æ—¶è¿˜ä¸æ”¯æŒåŸç”Ÿ<code>promise</code>æ—¶éœ€è¦æä¾›<code>polyfill</code>ã€‚å¦å¤–å°±æ˜¯<code>require.ensure</code>å¯ä»¥æ¥å—ç¬¬ä¸‰ä¸ªå‚æ•°ç”¨ä»¥ç»™<code>chunk</code>å‘½åï¼Œä½†æ˜¯<code>import</code>è¿™ä¸ª<code>API</code>æ²¡æœ‰æä¾›è¿™ä¸ªæ–¹æ³•</p>
<p>æ›´å¤šçš„ç»†èŠ‚å¤§å®¶å¯ä»¥è¿è¡Œ<a href="https://github.com/CommanderXL/xRoute/tree/webpack2">demo</