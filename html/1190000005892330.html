<blockquote><p>本系列文章对应游戏代码已开源 <a href="https://github.com/fwon/Sinuous">Sinuous game</a>。</p></blockquote>
<h3><strong>初衷</strong></h3>
<p>从萌发写一个小游戏的想法到完成游戏开发用了大概一周的业余时间。这个过程积累了一些经验，也算是参透了一些游戏开发的原理。在这里打算写一个系列教程，讲述怎样从零开始开发一款小游戏。让新者少走弯路，快速入手。也能让自己总结反思，发现问题。</p>
<p>在开始介绍如何写游戏前有必要重温一下canvas。它是本游戏的地基，建房子要快，首先地基要牢固。</p>
<h3><strong>Canvas</strong></h3>
<p>Canvas 对一个做前端的人来说再熟悉不过，html5中新增的这个功能为网页创造了无限可能，极大促进了网页富应用的开发。</p>
<p>而canvas对于大部分前端来说又是陌生的。</p>
<p>可以说在写这个游戏之前，我只是模糊地记得canvas的一些功能，以及经常在网上看到的酷炫高大上的基于canvas实现的效果，但自己绝对答不出canvas有哪些API，以及它们的具体使用方法。毕竟自己平时没做过类似的活动页，在大厂里这些工作一般都是让UED部门给承包了。</p>
<p>好了，废话不多说，进入主题。</p>
<p>在开始之前建议读一遍<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial">MDN的教程</a>，如果有《犀牛书》也可以看第21章关于canvas图形编程一节。</p>
<p>里面几个概念需要说一下。</p>
<p>context上下文：</p>
<pre><code class="javascript">var canvas = document.getElementById('canvas');
var cxt = canvas.getContext('2d');</code></pre>
<p>我们的图形并不是直接花在canvas上的，而是要通过<code>getContext</code>首先获得这个画板的上下文。传入的<code>2d</code>参数则表示我们创建的是一个2d的画布。后面所有的绘画都是直接操作cxt这个画布对象。</p>
<p>这个画布对象的全称是 CanvasRenderingContext2D，上面实现了很多绘制方法。具体用到可以参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D">这里</a>。</p>
<p>API虽然多，但是道理只有一个，万变不离其宗。</p>
<p>现实中我们画一个东西一般要有以下几个步骤：</p>
<ol>
<li><p>准备画布</p></li>
<li><p>选择画笔</p></li>
<li><p>选择颜料</p></li>
<li><p>画出轮廓</p></li>
<li><p>填充颜色</p></li>
</ol>
<p>而实际上CanvasRenderingContext2D API的设计也是大概遵循这样一个步骤，每一步都会最终影响画出来的图案。</p>
<p>我们可以将所有绘制分为两大类，一类是线，一类是面。线使用的API一般以stroke开头，面的API是以fill开头。</p>
<p>画一条线：</p>
<pre><code class="javascript">var c=document.getElementById("canvas");
var cxt=c.getContext("2d");                     //准备画布
cxt.lineWidth = 5;                              //选择画笔
cxt.strokeStyle = "red";                        //选择颜料
cxt.moveTo(10,10);                              //...
cxt.lineTo(150,50);                             //...
cxt.lineTo(10,50);                              //画出轮廓
cxt.stroke();                                   //填充颜色</code></pre>
<p>效果图：</p>
<p><img data-src="https://segmentfault.com/image?src=https://raw.githubusercontent.com/fwon/blog/master/assets/escape-1-1.png&amp;objectId=1190000005892330&amp;token=ed1e0deb5c77597e17c0720f161a0172" src="/img/escape-1-1.png&amp;objectId=1190000005892330&amp;token=ed1e0deb5c77597e17c0720f161a0172"></p>
<p>画一个三角形面</p>
<pre><code class="javascript">var c=document.getElementById("canvas");
var cxt=c.getContext("2d");                     //准备画布
cxt.lineWidth = 5;                              //选择画笔
cxt.fillStyle = "red";                          //选择颜料
cxt.moveTo(10,10);                              //...
cxt.lineTo(150,50);                             //...
cxt.lineTo(10,50);                              //画出轮廓
cxt.fill();                                     //填充颜色</code></pre>
<p>效果图：</p>
<p><img data-src="https://segmentfault.com/image?src=https://raw.githubusercontent.com/fwon/blog/master/assets/escape-1-2.png&amp;objectId=1190000005892330&amp;token=c16f515e0276b27d3fbb7c133ecd9a67" src="/img/escape-1-2.png&amp;objectId=1190000005892330&amp;token=c16f515e0276b27d3fbb7c133ecd9a67"></p>
<p>只要将stroke的地方换成fill, 就变成图形面的填充。而这里的lineWidth其实是可以省略的，它的默认值是1。</p>
<p>为了方便，CanvasRenderingContext2D为我们提供了一些简单的API，不需要使用moveTo和lineTo一条线段一条线段绘制。最重要的有几个：</p>
<p><a>arc</a>：画圆</p>
<pre><code class="javascript">cxt.arc(x, y, radius, startAngle, endAngle, anticlockwise);</code></pre>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillRect">fillRect</a>，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/strokeRect">strokeRect</a>：画矩形</p>
<pre><code class="javascript">cxt.fillRect(x, y, width, height)           //填充图形
cxt.strokeRect(x, y, width, height)         //不填充图形</code></pre>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillText">fillText</a>：写字</p>
<pre><code class="javascript">cxt.fillText(text, x, y [, maxWidth])</code></pre>
<p>当然CanvasRenderingContext2D还有更多丰富的API，但是基本都是基于上面5个步骤衍生出来的。基础开发中很少会使用到，可以用时再查阅文档。</p>
<p>为了能在一张画图上绘制多个图形而互不影响，CanvasRenderingContext2D提供了<br><code>beginPath</code>和 <code>closePath</code>。</p>
<p><code>beginPath</code> 用于在开始绘制一个独立图形的时候声明，在beginPath之后定义的画笔，颜料都不会影响到画图中的其他图形。可以看到下面的两条路径，各自定义了<code>strokeStyle</code>, 但是互不影响。</p>
<pre><code class="javascript">var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

//第一条路径
ctx.beginPath();
ctx.strokeStyle = 'blue';
ctx.moveTo(20,20);
ctx.lineTo(200,20);
ctx.stroke();

//第二条路径
ctx.beginPath();
ctx.strokeStyle = 'green';
ctx.moveTo(20,20);
ctx.lineTo(120,120);
ctx.stroke();</code></pre>
<p>效果图：</p>
<p><img data-src="https://segmentfault.com/image?src=https://raw.githubusercontent.com/fwon/blog/master/assets/escape-1-3.png&amp;objectId=1190000005892330&amp;token=1b55adb3a182d94cdb49d4d0ad6d225a" src="/img/escape-1-3.png&amp;objectId=1190000005892330&amp;token=1b55adb3a182d94cdb49d4d0ad6d225a"></p>
<p><code>closePath</code> 用于方便地将首尾两个点连接起来，形成一个封闭的图形，而不必手动调用lineTo闭合图形。 例如上方的三角形线段可以这样用：</p>
<pre><code class="javascript">var c=document.getElementById("canvas");
var cxt=c.getContext("2d");
cxt.moveTo(10,10);
cxt.lineTo(150,50);
cxt.lineTo(10,50);
cxt.closePath();
cxt.stroke();</code></pre>
<p>效果图：</p>
<p><img data-src="https://segmentfault.com/image?src=https://raw.githubusercontent.com/fwon/blog/master/assets/escape-1-4.png&amp;objectId=1190000005892330&amp;token=91709fe5b9902e4d2d868ecfdf8839fd" src="/img/escape-1-4.png&amp;objectId=1190000005892330&amp;token=91709fe5b9902e4d2d868ecfdf8839fd"></p>
<p>上面详细介绍的几个简单的API已经足够开发一个简单的游戏了。而如何使游戏界面更丰富炫酷，则需要用到更多的辅助方法。我们将在游戏中用到时再做具体介绍。</p>
<p>关于canvas的基础就温习到这，下一篇文章将进入本游戏的开发。敬请期待<br><a href="https://segmentfault.com/a/1190000005904245">《从零开始开发一款H5小游戏(二) - 创造游戏的世界，启动发动机》</a>。</p>